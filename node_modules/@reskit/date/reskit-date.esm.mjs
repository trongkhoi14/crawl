import{replaceNumber as e,toFullNumber as t,updateLocalized as a,zhLocalize as n,createZhRegexp as s,zhAlgorithm as r}from"@reskit/number";import{createOrRegexp as f,useTaggedRegexp as o,useNumberRegexp as i,createRegexp as d}from"@reskit/shared";let p={};function u(e,t){if(!p[e])return 0;const a=p[e];return a&&a[t]}let l=()=>({}),h={};function c(e){return h[e]}let Y,g=()=>new RegExp(""),M=()=>({}),m=["~","-","—"];function D(){const e=new Date;return{year:e.getFullYear(),month:e.getMonth()+1,date:e.getDate(),hour:e.getHours(),minute:e.getMinutes(),week:e.getDay()}}function x(e){const t=new Date;return e.year>=0&&t.setFullYear(e.year),e.month>=0&&t.setMonth(e.month-1),e.date>=0&&t.setDate(e.date),e.hour>=0&&t.setHours(e.hour),e.minute>=0&&t.setMinutes(e.minute),t.setSeconds(0,0),t}const y=new Map,O=new Map,R=new Map;let k;let S=0;function w(t){const a={yearOffset:0,monthOffset:0,weekOffset:0,dayOffset:0,timeOffset:0,hourOffset:0,minuteOffset:0};return Object.keys(t).forEach((n=>{const s=t[n];if(!s)return;const r=e(s),f=i(r);if(f.length>0&&r.includes("前")&&(f[0]=-f[0]),("week"===n||"weekOffset"===n)&&("weekOffset"===n&&f.length>0&&(a.weekOffset+=f[0]),"week"===n&&0===f.length&&(a.weekOffset+=u(n,s)),"week"===n&&f.length>0)){let e=r;f.forEach((t=>e=e.replace(t.toString(),""))),a.dayOffset+=f[0],a.weekOffset+=u(n,e),0===a.weekOffset&&(a.dayOffset=a.dayOffset-(D().week||7)),t[n]=e}"year"!==n&&"yearOffset"!==n||("year"===n&&(a.yearOffset+=u(n,s)),"yearOffset"===n&&f.length>0&&(a.yearOffset+=f[0])),"month"!==n&&"monthOffset"!==n||("month"===n&&(a.monthOffset+=u(n,s)),"monthOffset"===n&&f.length>0&&(a.monthOffset+=f[0])),"day"!==n&&"dayOffset"!==n||("day"===n&&(a.dayOffset+=u(n,s)),"dayOffset"===n&&f.length>0&&(a.dayOffset+=f[0])),"time"===n&&(a.timeOffset=u(n,s)),"hourOffset"!==n&&"minuteOffset"!==n||f.length>0&&(a[n]=f[0])})),a}function I(e){let t=e;const a=l(),n={yearOffset:a.yearOffsetRegexp,monthOffset:a.monthOffsetRegexp,weekOffset:a.weekOffsetRegexp,dayOffset:a.dayOffsetRegexp,hourOffset:a.hourOffsetRegexp,minuteOffset:a.minuteOffsetRegexp,year:a.yearRegexp,month:a.monthRegexp,week:a.weekRegexp,day:a.dayRegexp,time:a.timeRegexp},s=(t.match(a.offsetRegexp)||[]).filter((e=>!!e));return y.clear(),s.forEach((e=>{const a=o(e,n);Object.keys(a).forEach((e=>{"week"===e&&(a[e]=a[e].replace(/[天日末]/g,"七")),a[e]=a[e].replace("的","")}));const s=`DY_TIME_MASK_${function(){let e="I";for(let t=0;t<S;t++)e=`${e}I`;return S++,e}()}_`;y.set(s,{mask:s,text:e,value:w(a)}),t=t.replace(e,s)})),S=0,t}function $(e){let a=e;const n=g();return(a.match(n)||[]).filter((e=>!!e)).forEach((e=>{const[n,s]=e.replace("分","").split("点"),r=n?`${c(n)||t(n)}`:"00",f=s?`${c(s)||t(s)}`:"00",o=`${r.padStart(2,"0")}:${f.padStart(2,"0")}`;a=a.replace(e,o)})),a}let T=0;function v(e){let t=e;const a=function(e){const t={YYYYMMDD:[],YYMMDD:[],MMDD:[],MMDDYYYY:[],MMDDYY:[],DD:[]};return(e.match(M().dateRegexp)||[]).forEach((e=>{const{YYYYMMDDRegexp:a,YYMMDDRegexp:n,MMDDRegexp:s,MMDDYYYYRegexp:r,MMDDYYRegexp:f,DDRegexp:o}=M();return a.test(e)?t.YYYYMMDD.push(e):r.test(e)?t.MMDDYYYY.push(e):n.test(e)?t.YYMMDD.push(e):f.test(e)?t.MMDDYY.push(e):s.test(e)?t.MMDD.push(e):o.test(e)?t.DD.push(e):void 0})),t}(e),{YYYYMMDDRegexp:n,YYMMDDRegexp:s,MMDDRegexp:r,MMDDYYYYRegexp:f,MMDDYYRegexp:o,DDRegexp:i}=M(),d={YYYYMMDD:n,YYMMDD:s,MMDD:r,MMDDYYYY:f,MMDDYY:o,DD:i};return O.clear(),Object.entries(a).forEach((([e,a])=>{const n=d[e];n&&a.forEach((e=>{const[,,a,,s,,r]=n.exec(e)||[],f=`STD_DATE_MASK_${function(){let e="I";for(let t=0;t<T;t++)e=`${e}I`;return T++,e}()}_`,o=function(e,t,a){const n=D();if(!t||!t&&!a)return{year:n.year,month:n.month,day:e};if(!a)return{year:n.year,month:e,day:t};if(e>2e3)return{year:e,month:t,day:a};if(a>2e3)return{year:a,month:e,day:t};const s={year:e+2e3,month:t,day:a,date:-1},r={year:a+2e3,month:e,day:t,date:-1};if(e>12)return s;if(t>12)return r;s.date=new Date(e+2e3,t,a).getTime(),r.date=new Date(a+2e3,e,t).getTime();const f=s.date>=r.date?s:r,o=s.date<r.date?s:r;return o.date>Date.now()?o:(f.date,Date.now(),f)}(parseFloat(a||"0"),parseFloat(s||"0"),parseFloat(r||"0"));O.set(f,{mask:f,text:e,value:{year:o.year,month:o.month,day:o.day}}),t=t.replace(e,f),n.lastIndex=0}))})),T=0,t}function j(e){let t=e;const a=[],n=t.match((k||(k=/(DY|STD)_(TIME|DATE)_MASK_I+_/g),k))||[];if(0===n.length)return a;const s=[];n.forEach((e=>{const[a,n]=t.split(e);a&&s.push(a),s.push(e),t=n})),t&&s.push(t);const r=D(),o={year:-1,month:-1,date:-1,hour:0,minute:0};let i=!1,d=!1,p=!1;return s.forEach((e=>{if(y.has(e)){const{yearOffset:a,monthOffset:s,weekOffset:f,dayOffset:u,timeOffset:l,hourOffset:h,minuteOffset:c}=y.get(e).value;if(i=!0,p||(o.year=a+r.year,o.month=s+r.month,o.date=u+r.date),!d){if(n=r,(t=o).year===n.year&&t.month===n.month&&t.date===n.date&&(o.hour=h+r.hour,o.minute=c+r.minute),f){const e=r.week||7;o.date=r.date+u+(7*f-e)}l&&(o.hour=l,o.minute=0)}}else{var t,n;if(R.has(e)){const t=R.get(e).value;return d=!0,i&&o.hour?o.hour=o.hour>12&&t.hour<12?12+t.hour:t.hour:o.hour=t.hour,void(o.minute=t.minute)}if(O.has(e)){const t=O.get(e).value;return p=!0,o.year=t.year,o.month=t.month,void(o.date=t.day)}(Y||(Y=f(m,void 0,void 0,void 0,!1)),Y.lastIndex=0,Y).test(e)&&((i||d||p)&&a.push(x(o)),d=!1,p=!1)}})),(i||d||p)&&a.push(x(o)),a}let E=!1;function b(t){let a=t;a=I(a),a=$(a),a=e(a),a=$(a),a=v(a);return j(a)}function _({useRegexp:e,data:t}){var n;a(t.zhNumber.data,t.zhNumber.algorithm),n={...e,...t},l=n.useTimeOffsetRegexp,g=n.useSpecialTimeRegexp,M=n.useStandardDateRegexp,m=n.dateSplitList,h=n.specialTimeMap,p=n.dateTimeOffsetMap,E=!0}function B(){}const F={},z={year:{"大前年":-3,"前年":-2,"去年":-1,"上一年":-1,"今年":0,"明年":1,"后年":2},month:{"上个月":-1,"上月":-1,"这个月":0,"这月":0,"本月":0,"下个月":1,"下月":1},week:{"上上周":-2,"上周":-1,"上个周":-1,"周":0,"这周":0,"本周":0,"下周":1,"下个周":1,"下下周":2,"上星期":-1,"上个星期":-1,"星期":0,"这星期":0,"这个星期":0,"下个星期":1,"下星期":1,"上礼拜":-1,"上个礼拜":-1,"礼拜":0,"这礼拜":0,"这个礼拜":0,"下个礼拜":1,"下礼拜":1},day:{"大前天":-3,"前天":-2,"前一天":-1,"昨天":-1,"昨日":-1,"今天":0,"今日":0,"现在":0,"明天":1,"明日":1,"后天":2,"大后天":3,Today:0,Tomorrow:1,Yesterday:-1},time:{"凌晨":2,"清晨":6,"早晨":7,"早上":10,"上午":10,"中午":12,"午后":13,"下午":15,"傍晚":18,"晚上":20,"深夜":23}},A="[0-9零一二三四五六七八九十两]",H=`(${Object.keys(z.year).join("|")})`,L=`(${Object.keys(z.month).join("|")})`,K=`(${Object.keys(z.week).join("|")})`,N=`(${Object.keys(z.day).join("|")})`,Z=`(${Object.keys(z.time).join("|")})`;let q,C,G,J,P,Q,U,V,W,X,ee,te;function ae(){return q||function(){const e=`(${H}的*)`,t=`(${L}的*)`,a=`(${K}的?((周|星期|礼拜)?[一二三四五六日天末1-6]?的?))`,n=`(${N}的*)`,s=`(${Z}的*)`,r=`((${A}+年[之以]?[前后])|(过了${A}+年))`,o=`((${A}+个?月[之以]?[前后])|(过了${A}+个?月))`,i=`((${A}+个?(周|星期|礼拜)[之以]?[前后])|(过了${A}+(周|星期|礼拜)))`,p=`((${A}+天[之以]?[前后])|(过了${A}+天))`,u=`((${A}+(小时[之以]?[前后]))|(过了${A}+小时))`,l=`((${A}+分钟[之以]?[前后])|(过了${A}+分钟))`;C=d(r,"g"),G=d(o,"g"),J=d(i,"g"),P=d(p,"g"),Q=d(u,"g"),U=d(l,"g"),V=d(e,"g"),W=d(t,"g"),X=d(a,"g"),ee=d(n,"g"),te=d(s,"g"),q=f([e,r,t,o,a,i,n,p,s,u,l],"+",void 0,void 0,!1)}(),q.lastIndex=0,C.lastIndex=0,G.lastIndex=0,J.lastIndex=0,P.lastIndex=0,Q.lastIndex=0,U.lastIndex=0,V.lastIndex=0,W.lastIndex=0,X.lastIndex=0,ee.lastIndex=0,te.lastIndex=0,{offsetRegexp:q,yearOffsetRegexp:C,monthOffsetRegexp:G,weekOffsetRegexp:J,dayOffsetRegexp:P,hourOffsetRegexp:Q,minuteOffsetRegexp:U,yearRegexp:V,monthRegexp:W,weekRegexp:X,dayRegexp:ee,timeRegexp:te}}const ne={"整":0,"一刻":15,"半":30,"三刻":45};let se;function re(){return se||(se=d("((二十{1-4}?)|([十1]{0-9}?)|{0-9-2})点({special-time}|((({0-5}?十?{0-9}?)|(零?{0-9}))分?))?","g",{"1-4":"[一二三四1-4]","1-5":"[一二三四五1-5]","1-7":"[一二三四五六日1-7]","1-9":"[一二三四五六七八九十1-9]","0-5":"[零一二三四五0-5]","0-9":"[零一二三四五六七八九十0-9]","0-9-2":"[零一二三四五六七八九十两0-9]","special-time":Object.keys(ne).join("|")})),se.lastIndex=0,se}const fe={YYYY:"(20\\d{2})",YY:"(\\d{2})",MM:"(1[0-2]|0?[1-9])",dd:"(3[0-1]|[1-2][0-9]|0?[1-9])",hh:"(20|21|22|23|[0-1]?\\d)",mm:"([0-5]?\\d)",YSplit:"[-/年.,\\s]",YBackSplit:"[年.,\\s]?",MSplit:"[-/月.,\\s]",dFrontSplit:"[日号]",dSplit:"[-/日号.,\\s]",dBackSplit:"[日号.,\\s]?",hSplit:"[:：点时]",mSplit:"[:：分s]"},oe="({YYYY}{YSplit})({MM}{MSplit})({dd}{dBackSplit})",ie="({YY}{YSplit})({MM}{MSplit})({dd}{dBackSplit})",de="({MM}{MSplit})({dd}{dBackSplit})",pe="({MM}{MSplit})({dd}{dSplit})({YYYY}{YBackSplit})",ue="({MM}{MSplit})({dd}{dSplit})({YYYY}{YBackSplit})",le="({dd}{dFrontSplit})";let he,ce,Ye,ge,Me,me,De,xe;function ye(){return he||(ce=d(oe,"g",fe),Ye=d(ie,"g",fe),ge=d(de,"g",fe),Me=d(pe,"g",fe),me=d(ue,"g",fe),De=d(le,"g",fe),he=f([oe,pe,ie,ue,de,le],void 0,"g",fe,!1),xe=d("({hh}{hSplit})({mm}?{mSplit}?)","g",fe)),ce.lastIndex=0,Ye.lastIndex=0,ge.lastIndex=0,Me.lastIndex=0,me.lastIndex=0,De.lastIndex=0,he.lastIndex=0,xe&&(xe.lastIndex=0),{dateRegexp:he,YYYYMMDDRegexp:ce,YYMMDDRegexp:Ye,MMDDRegexp:ge,MMDDYYYYRegexp:Me,MMDDYYRegexp:me,DDRegexp:De,HHMMRegexp:xe}}const Oe={dateTimeOffsetMap:z,specialTimeMap:ne,standardDateMap:fe,dateSplitList:["到","至","~","-","—","——"],zhNumber:{data:{...n,regexp:s()},algorithm:r}};function Re(){return{useTimeOffsetRegexp:ae,useSpecialTimeRegexp:re,useStandardDateRegexp:ye}}export{B as createEnRegexp,Re as createZhRegexp,F as enLocalize,b as extractDate,_ as updateLocalized,Oe as zhLocalize};
