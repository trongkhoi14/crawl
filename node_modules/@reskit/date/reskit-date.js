!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@reskit/number"),require("@reskit/shared")):"function"==typeof define&&define.amd?define(["exports","@reskit/number","@reskit/shared"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).KitDate={},e.number,e.shared)}(this,(function(e,t,a){"use strict";let n={};function r(e,t){if(!n[e])return 0;const a=n[e];return a&&a[t]}let s=()=>({}),f={};function o(e){return f[e]}let i,p=()=>new RegExp(""),d=()=>({}),u=["~","-","—"];function c(){const e=new Date;return{year:e.getFullYear(),month:e.getMonth()+1,date:e.getDate(),hour:e.getHours(),minute:e.getMinutes(),week:e.getDay()}}function l(e){const t=new Date;return e.year>=0&&t.setFullYear(e.year),e.month>=0&&t.setMonth(e.month-1),e.date>=0&&t.setDate(e.date),e.hour>=0&&t.setHours(e.hour),e.minute>=0&&t.setMinutes(e.minute),t.setSeconds(0,0),t}const g=new Map,h=new Map,x=new Map;let Y;let m=0;function M(e){const n={yearOffset:0,monthOffset:0,weekOffset:0,dayOffset:0,timeOffset:0,hourOffset:0,minuteOffset:0};return Object.keys(e).forEach((s=>{const f=e[s];if(!f)return;const o=t.replaceNumber(f),i=a.useNumberRegexp(o);if(i.length>0&&o.includes("前")&&(i[0]=-i[0]),("week"===s||"weekOffset"===s)&&("weekOffset"===s&&i.length>0&&(n.weekOffset+=i[0]),"week"===s&&0===i.length&&(n.weekOffset+=r(s,f)),"week"===s&&i.length>0)){let t=o;i.forEach((e=>t=t.replace(e.toString(),""))),n.dayOffset+=i[0],n.weekOffset+=r(s,t),0===n.weekOffset&&(n.dayOffset=n.dayOffset-(c().week||7)),e[s]=t}"year"!==s&&"yearOffset"!==s||("year"===s&&(n.yearOffset+=r(s,f)),"yearOffset"===s&&i.length>0&&(n.yearOffset+=i[0])),"month"!==s&&"monthOffset"!==s||("month"===s&&(n.monthOffset+=r(s,f)),"monthOffset"===s&&i.length>0&&(n.monthOffset+=i[0])),"day"!==s&&"dayOffset"!==s||("day"===s&&(n.dayOffset+=r(s,f)),"dayOffset"===s&&i.length>0&&(n.dayOffset+=i[0])),"time"===s&&(n.timeOffset=r(s,f)),"hourOffset"!==s&&"minuteOffset"!==s||i.length>0&&(n[s]=i[0])})),n}function D(e){let t=e;const n=s(),r={yearOffset:n.yearOffsetRegexp,monthOffset:n.monthOffsetRegexp,weekOffset:n.weekOffsetRegexp,dayOffset:n.dayOffsetRegexp,hourOffset:n.hourOffsetRegexp,minuteOffset:n.minuteOffsetRegexp,year:n.yearRegexp,month:n.monthRegexp,week:n.weekRegexp,day:n.dayRegexp,time:n.timeRegexp},f=(t.match(n.offsetRegexp)||[]).filter((e=>!!e));return g.clear(),f.forEach((e=>{const n=a.useTaggedRegexp(e,r);Object.keys(n).forEach((e=>{"week"===e&&(n[e]=n[e].replace(/[天日末]/g,"七")),n[e]=n[e].replace("的","")}));const s=`DY_TIME_MASK_${function(){let e="I";for(let t=0;t<m;t++)e=`${e}I`;return m++,e}()}_`;g.set(s,{mask:s,text:e,value:M(n)}),t=t.replace(e,s)})),m=0,t}function R(e){let a=e;const n=p();return(a.match(n)||[]).filter((e=>!!e)).forEach((e=>{const[n,r]=e.replace("分","").split("点"),s=n?`${o(n)||t.toFullNumber(n)}`:"00",f=r?`${o(r)||t.toFullNumber(r)}`:"00",i=`${s.padStart(2,"0")}:${f.padStart(2,"0")}`;a=a.replace(e,i)})),a}let y=0;function O(e){let t=e;const a=function(e){const t={YYYYMMDD:[],YYMMDD:[],MMDD:[],MMDDYYYY:[],MMDDYY:[],DD:[]};return(e.match(d().dateRegexp)||[]).forEach((e=>{const{YYYYMMDDRegexp:a,YYMMDDRegexp:n,MMDDRegexp:r,MMDDYYYYRegexp:s,MMDDYYRegexp:f,DDRegexp:o}=d();return a.test(e)?t.YYYYMMDD.push(e):s.test(e)?t.MMDDYYYY.push(e):n.test(e)?t.YYMMDD.push(e):f.test(e)?t.MMDDYY.push(e):r.test(e)?t.MMDD.push(e):o.test(e)?t.DD.push(e):void 0})),t}(e),{YYYYMMDDRegexp:n,YYMMDDRegexp:r,MMDDRegexp:s,MMDDYYYYRegexp:f,MMDDYYRegexp:o,DDRegexp:i}=d(),p={YYYYMMDD:n,YYMMDD:r,MMDD:s,MMDDYYYY:f,MMDDYY:o,DD:i};return h.clear(),Object.entries(a).forEach((([e,a])=>{const n=p[e];n&&a.forEach((e=>{const[,,a,,r,,s]=n.exec(e)||[],f=`STD_DATE_MASK_${function(){let e="I";for(let t=0;t<y;t++)e=`${e}I`;return y++,e}()}_`,o=function(e,t,a){const n=c();if(!t||!t&&!a)return{year:n.year,month:n.month,day:e};if(!a)return{year:n.year,month:e,day:t};if(e>2e3)return{year:e,month:t,day:a};if(a>2e3)return{year:a,month:e,day:t};const r={year:e+2e3,month:t,day:a,date:-1},s={year:a+2e3,month:e,day:t,date:-1};if(e>12)return r;if(t>12)return s;r.date=new Date(e+2e3,t,a).getTime(),s.date=new Date(a+2e3,e,t).getTime();const f=r.date>=s.date?r:s,o=r.date<s.date?r:s;return o.date>Date.now()?o:(f.date,Date.now(),f)}(parseFloat(a||"0"),parseFloat(r||"0"),parseFloat(s||"0"));h.set(f,{mask:f,text:e,value:{year:o.year,month:o.month,day:o.day}}),t=t.replace(e,f),n.lastIndex=0}))})),y=0,t}function k(e){let t=e;const n=[],r=t.match((Y||(Y=/(DY|STD)_(TIME|DATE)_MASK_I+_/g),Y))||[];if(0===r.length)return n;const s=[];r.forEach((e=>{const[a,n]=t.split(e);a&&s.push(a),s.push(e),t=n})),t&&s.push(t);const f=c(),o={year:-1,month:-1,date:-1,hour:0,minute:0};let p=!1,d=!1,m=!1;return s.forEach((e=>{if(g.has(e)){const{yearOffset:a,monthOffset:n,weekOffset:s,dayOffset:i,timeOffset:u,hourOffset:c,minuteOffset:l}=g.get(e).value;if(p=!0,m||(o.year=a+f.year,o.month=n+f.month,o.date=i+f.date),!d){if(r=f,(t=o).year===r.year&&t.month===r.month&&t.date===r.date&&(o.hour=c+f.hour,o.minute=l+f.minute),s){const e=f.week||7;o.date=f.date+i+(7*s-e)}u&&(o.hour=u,o.minute=0)}}else{var t,r;if(x.has(e)){const t=x.get(e).value;return d=!0,p&&o.hour?o.hour=o.hour>12&&t.hour<12?12+t.hour:t.hour:o.hour=t.hour,void(o.minute=t.minute)}if(h.has(e)){const t=h.get(e).value;return m=!0,o.year=t.year,o.month=t.month,void(o.date=t.day)}(i||(i=a.createOrRegexp(u,void 0,void 0,void 0,!1)),i.lastIndex=0,i).test(e)&&((p||d||m)&&n.push(l(o)),d=!1,m=!1)}})),(p||d||m)&&n.push(l(o)),n}let S=!1;const w={year:{"大前年":-3,"前年":-2,"去年":-1,"上一年":-1,"今年":0,"明年":1,"后年":2},month:{"上个月":-1,"上月":-1,"这个月":0,"这月":0,"本月":0,"下个月":1,"下月":1},week:{"上上周":-2,"上周":-1,"上个周":-1,"周":0,"这周":0,"本周":0,"下周":1,"下个周":1,"下下周":2,"上星期":-1,"上个星期":-1,"星期":0,"这星期":0,"这个星期":0,"下个星期":1,"下星期":1,"上礼拜":-1,"上个礼拜":-1,"礼拜":0,"这礼拜":0,"这个礼拜":0,"下个礼拜":1,"下礼拜":1},day:{"大前天":-3,"前天":-2,"前一天":-1,"昨天":-1,"昨日":-1,"今天":0,"今日":0,"现在":0,"明天":1,"明日":1,"后天":2,"大后天":3,Today:0,Tomorrow:1,Yesterday:-1},time:{"凌晨":2,"清晨":6,"早晨":7,"早上":10,"上午":10,"中午":12,"午后":13,"下午":15,"傍晚":18,"晚上":20,"深夜":23}},I="[0-9零一二三四五六七八九十两]",$=`(${Object.keys(w.year).join("|")})`,b=`(${Object.keys(w.month).join("|")})`,T=`(${Object.keys(w.week).join("|")})`,j=`(${Object.keys(w.day).join("|")})`,v=`(${Object.keys(w.time).join("|")})`;let E,_,z,F,N,B,L,A,H,K,q,Z;function C(){return E||function(){const e=`(${$}的*)`,t=`(${b}的*)`,n=`(${T}的?((周|星期|礼拜)?[一二三四五六日天末1-6]?的?))`,r=`(${j}的*)`,s=`(${v}的*)`,f=`((${I}+年[之以]?[前后])|(过了${I}+年))`,o=`((${I}+个?月[之以]?[前后])|(过了${I}+个?月))`,i=`((${I}+个?(周|星期|礼拜)[之以]?[前后])|(过了${I}+(周|星期|礼拜)))`,p=`((${I}+天[之以]?[前后])|(过了${I}+天))`,d=`((${I}+(小时[之以]?[前后]))|(过了${I}+小时))`,u=`((${I}+分钟[之以]?[前后])|(过了${I}+分钟))`;_=a.createRegexp(f,"g"),z=a.createRegexp(o,"g"),F=a.createRegexp(i,"g"),N=a.createRegexp(p,"g"),B=a.createRegexp(d,"g"),L=a.createRegexp(u,"g"),A=a.createRegexp(e,"g"),H=a.createRegexp(t,"g"),K=a.createRegexp(n,"g"),q=a.createRegexp(r,"g"),Z=a.createRegexp(s,"g"),E=a.createOrRegexp([e,f,t,o,n,i,r,p,s,d,u],"+",void 0,void 0,!1)}(),E.lastIndex=0,_.lastIndex=0,z.lastIndex=0,F.lastIndex=0,N.lastIndex=0,B.lastIndex=0,L.lastIndex=0,A.lastIndex=0,H.lastIndex=0,K.lastIndex=0,q.lastIndex=0,Z.lastIndex=0,{offsetRegexp:E,yearOffsetRegexp:_,monthOffsetRegexp:z,weekOffsetRegexp:F,dayOffsetRegexp:N,hourOffsetRegexp:B,minuteOffsetRegexp:L,yearRegexp:A,monthRegexp:H,weekRegexp:K,dayRegexp:q,timeRegexp:Z}}const G={"整":0,"一刻":15,"半":30,"三刻":45};let J;function P(){return J||(J=a.createRegexp("((二十{1-4}?)|([十1]{0-9}?)|{0-9-2})点({special-time}|((({0-5}?十?{0-9}?)|(零?{0-9}))分?))?","g",{"1-4":"[一二三四1-4]","1-5":"[一二三四五1-5]","1-7":"[一二三四五六日1-7]","1-9":"[一二三四五六七八九十1-9]","0-5":"[零一二三四五0-5]","0-9":"[零一二三四五六七八九十0-9]","0-9-2":"[零一二三四五六七八九十两0-9]","special-time":Object.keys(G).join("|")})),J.lastIndex=0,J}const Q={YYYY:"(20\\d{2})",YY:"(\\d{2})",MM:"(1[0-2]|0?[1-9])",dd:"(3[0-1]|[1-2][0-9]|0?[1-9])",hh:"(20|21|22|23|[0-1]?\\d)",mm:"([0-5]?\\d)",YSplit:"[-/年.,\\s]",YBackSplit:"[年.,\\s]?",MSplit:"[-/月.,\\s]",dFrontSplit:"[日号]",dSplit:"[-/日号.,\\s]",dBackSplit:"[日号.,\\s]?",hSplit:"[:：点时]",mSplit:"[:：分s]"},U="({YYYY}{YSplit})({MM}{MSplit})({dd}{dBackSplit})",V="({YY}{YSplit})({MM}{MSplit})({dd}{dBackSplit})",W="({MM}{MSplit})({dd}{dBackSplit})",X="({MM}{MSplit})({dd}{dSplit})({YYYY}{YBackSplit})",ee="({MM}{MSplit})({dd}{dSplit})({YYYY}{YBackSplit})",te="({dd}{dFrontSplit})";let ae,ne,re,se,fe,oe,ie,pe;function de(){return ae||(ne=a.createRegexp(U,"g",Q),re=a.createRegexp(V,"g",Q),se=a.createRegexp(W,"g",Q),fe=a.createRegexp(X,"g",Q),oe=a.createRegexp(ee,"g",Q),ie=a.createRegexp(te,"g",Q),ae=a.createOrRegexp([U,X,V,ee,W,te],void 0,"g",Q,!1),pe=a.createRegexp("({hh}{hSplit})({mm}?{mSplit}?)","g",Q)),ne.lastIndex=0,re.lastIndex=0,se.lastIndex=0,fe.lastIndex=0,oe.lastIndex=0,ie.lastIndex=0,ae.lastIndex=0,pe&&(pe.lastIndex=0),{dateRegexp:ae,YYYYMMDDRegexp:ne,YYMMDDRegexp:re,MMDDRegexp:se,MMDDYYYYRegexp:fe,MMDDYYRegexp:oe,DDRegexp:ie,HHMMRegexp:pe}}const ue={dateTimeOffsetMap:w,specialTimeMap:G,standardDateMap:Q,dateSplitList:["到","至","~","-","—","——"],zhNumber:{data:{...t.zhLocalize,regexp:t.createZhRegexp()},algorithm:t.zhAlgorithm}};e.createEnRegexp=function(){},e.createZhRegexp=function(){return{useTimeOffsetRegexp:C,useSpecialTimeRegexp:P,useStandardDateRegexp:de}},e.enLocalize={},e.extractDate=function(e){let a=e;return a=D(a),a=R(a),a=t.replaceNumber(a),a=R(a),a=O(a),k(a)},e.updateLocalized=function({useRegexp:e,data:a}){var r;t.updateLocalized(a.zhNumber.data,a.zhNumber.algorithm),r={...e,...a},s=r.useTimeOffsetRegexp,p=r.useSpecialTimeRegexp,d=r.useStandardDateRegexp,u=r.dateSplitList,f=r.specialTimeMap,n=r.dateTimeOffsetMap,S=!0},e.zhLocalize=ue}));
