!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).KitShared={})}(this,(function(e){"use strict";function t(e){return!e.items||0===e.items.length}function n(e,n){!function e(r){t(r)?n&&n(r):(n&&n(r,!1),r.items.forEach((t=>e(t))),n&&n(r,!0))}(e)}function r(e){return e.toString().replace(/[-[\]{}()*+!<=:?.\/\\^$|#\s,]/g,"\\$&")}function o(e,t,n){if(!n)return new RegExp(e,t);let r=e;return Object.keys(n).forEach((e=>{r=r.replace(new RegExp(`{${e}}`,"g"),n[e])})),new RegExp(r,t)}function i(e){const t=e.charCodeAt(0);return t>=48&&t<58?t-48:-1}function c(e,t){let n=0,r=0;for(;t<e.length;){const o=e[t];if("."===o){r=1,t++;continue}const c=i(o);if(-1===c)break;0===r?n=10*n+c:(r*=10,n+=c/r),t++}return{num:n,index:t}}function s(e){return"("===e}const u=()=>{};function a(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:u};return e.promise=new Promise(((t,n)=>{e.resolve=n=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=t=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(t))}})),e}e.calculate=function(e){const t=[],n=[];function r(){if(s(n.at(-1)))return;const e=t.pop(),r=t.pop(),o=n.pop();null!=e&&null!=r&&o&&t.push(function(e,t,n){switch(n){case"+":return e+t;case"-":return e-t;case"*":return e*t;case"/":return Math.floor(e/t)}return 0}(r,e,o))}function o(e){const t=n.at(-1);return!t||s(t)||function(e,t){return["*","/"].includes(e)&&["+","-"].includes(t)}(e,t)}for(let i=0;i<e.length;i++){const u=e[i];if(" "!==u)switch(u){case"(":n.push(u);break;case")":for(;"("!==n.at(-1);)r();n.pop();break;case"+":case"-":case"*":case"/":{let c=i-1;for(;c>=0&&" "===e[c];)c-=1;"-"!==u||0!==i&&!s(e[c])||t.push(0);let a=o(u);for(;!a;)r(),a=o(u);n.push(u);break}default:{const{num:n,index:r}=c(e,i);i=r-1,t.push(n);break}}}for(;n.length>0;)r();return t[0]||0},e.createDefer=a,e.createExistRegexp=function(e,t,n){let i=`${e.map(r).join("?")}?`;return t&&(i=`(${i})${t}`),o(i,n||"g")},e.createOrRegexp=function(e,t,n,i,c=!0){let s=(c?e.map(r):e).join("|");return t&&(s=`(${s})${t}`),o(s,n||"g",i)},e.createRegexp=o,e.createResolvedDefer=function(e){const t=a();return t.resolve(e),t},e.createTimeoutDefer=function(e){const t=a(),n=setTimeout(t.resolve,e);return t.cancel=()=>clearTimeout(n),t},e.dataURLtoFile=function(e,t="temp"){const[n,r]=e.split(",")||[];if(!n||!r)throw new Error("invalid dataURL!");const o=(n.match(/:(.*?);/)||[])[1],i=o.split("/")[1],c=window.atob(r);let s=c.length,u=new Uint8Array(s);for(;s--;)u[s]=c.charCodeAt(s);return new File([u],`${t}.${i}`,{type:o})},e.dfs=n,e.fileToDataURL=async function(e){let t=new FileReader,n=a();return t.readAsDataURL(e),t.onload=e=>n.resolve(t.result),t.onerror=n.reject,n.promise},e.getPaths=function(e){let r=[],o=[];return n(e,((e,n)=>t(e)?o.push([...r,e]):n?r.pop():r.push(e))),o},e.getRangeNumber=c,e.isLeaf=t,e.toNumber=i,e.useNumberRegexp=function(e){return(e.match(/-?\d+(\.\d+)?/g)||[]).map((e=>parseFloat(e)))},e.useTaggedRegexp=function(e,t){const n={};return Object.entries(t).forEach((([t,r])=>{(e.match(r)||[]).forEach((e=>n[t]=e))})),n}}));
