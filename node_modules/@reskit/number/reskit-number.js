!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@reskit/shared")):"function"==typeof define&&define.amd?define(["exports","@reskit/shared"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).KitNumber={},e.shared)}(this,(function(e,t){"use strict";let n,r,i;function o(e){n=e,r=e.regexp}function c(e){i=e}function l(e){const t=e.match(r.localDecimalRegexp)||[];let n=e;return t.forEach((e=>{n=n.replace(e,i.toNumber(e).toString())})),n}function u(e){const t=e.match(r.localFractionRegexp)||[];let n=e;return t.forEach((e=>{n=n.replace(e,i.toNumber(e).toString())})),n}function a(e){if(!i||!i.toNumber)return e;const t=e.match(r.localNumberRegexp)||[],o=Object.keys(n.unit);let c=e;return t.forEach((e=>{o.includes(e)||(c=c.replace(e,i.toNumber(e).toString()))})),c}function s(e){if(!i||!i.toLocalized)return e;let t=e;return t=i.toLocalized(e),t=function(e){const t=e.match(r.localNegativeRegexp)||[];let n=e;return t.forEach((e=>{n=n.replace(e,i.toNumber(e).toString())})),n}(t),t=l(t),t=u(t),t}const f={num:{One:1,Two:2,Three:3,Four:4,Five:5,Six:6,Seven:7,Eight:8,Nine:9,Zero:0,Half:.5},unit:{Ten:10,Hundred:1e3,Thousand:1e3,Million:1e6,Billion:1e8},flag:"Point"},g={"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9,"十":10,"零":0,"〇":0,"两":2,"半":.5},p={0:"零",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七",8:"八",9:"九"},m={"十":10,"百":100,"千":1e3,"万":1e4,"亿":1e8},d=Object.keys(m),x="点",h="又",b="分之",R="负",N={localNumber:g,numberLocal:p,unit:m,decimalFlag:x};let j,$,L,O,z,y,k,F,I;function S(e){return d.some((t=>t===e))}function E(e){return["万","亿"].includes(e)}function T(e){return"零"===e}function v(e){let t=0;for(let n=0;n<e.length;n++)t=10*t+(g[e[n]]||0);return t}function D(e){return e.startsWith(R)?function(e){return(e=e.split(R)[1]).startsWith("的")&&(e=e.split("的")[1]),-D(e)}(e):e.includes(x)?function(e){const[t,n]=e.split(x),r=n.at(-1);let i=D(t.trim()),o=D(n.trim());if(r&&S(r)){i*=m[r];let e=0;for(;T(n[e]);)e+=1,o/=10;return i+o/10}return parseFloat(`${i}.${o}`)}(e):e.includes(b)?function(e){let[t,n]=e.split(h);n||(n=t,t="");let[r,i]=n.split(b),o=t?D(t.trim()):0,c=D(r.trim());return o+D(i.trim())/c}(e):function(e){let t=$.test(e);return $.lastIndex=0,t}(e)?function(e){let t=0,n=0,r="",i=0;for(;i<e.length;){const o=e[i];if(0===i&&S(o)){t=m[o],i++;continue}S(o)&&(t=E(o)?(t+n)*m[o]:t+n*m[o],r=T(e[i+1])?"":o,n=0,i++);let c=i;for(;i<e.length&&!S(e[i]);)i++;i>c&&(n=v(e.substring(c,i)))}return r&&(n=n*m[r]/10),t+n}(e):v(e)}const M={toNumber:D,toLocalized:function(e){if("string"==typeof e)return function(e){if(!isNaN(Number(e)))return e;let t=e.split("");for(let e=0;e<t.length;e++){const n=parseInt(t[e]);Number.isInteger(n)&&(t[e]=p[n]),"."===t[e]&&0!==e&&1!=t.length-1&&z.test(t[e-1])&&(z.lastIndex=0,(z.test(t[e+1])||Number.isInteger(parseInt(t[e+1])))&&(t[e]=x),z.lastIndex=0)}return t.join("")}(e);let t="";for(;e;)t=p[e%10]+t,e=Math.floor(e/10);return t}};function A(e){let t=e;return t=s(t),t=a(t),t}e.createZhRegexp=function(){if(!j){const e=Object.keys(g),n=Object.keys(p),r=Object.keys(m),i=[...e,...r];j=t.createOrRegexp(e,"+"),$=t.createOrRegexp(r),L=t.createOrRegexp(n,"+"),O=t.createOrRegexp(i,"+"),z=t.createOrRegexp([...i,...n],"+"),y=t.createRegexp(`{int}${x}{decimal}{unit}`,"g",{int:`(${i.join("|")})+`,decimal:`(${e.join("|")})+`,unit:`(${r.join("|")})?(${e.join("|")})*`}),k=t.createRegexp(`{base}${h}?{denominator}${b}{numerator}`,"g",{base:`(${i.join("|")})?`,denominator:`(${i.join("|")})+`,numerator:`(${i.join("|")})+`}),F=t.createRegexp(`${R}的?{int}`,"g",{int:`(${[...i,h,b,x].join("|")})+`}),I=t.createRegexp("{front}{unit}{back}","g",{front:"(\\d+(.\\d+)?)",unit:`(${r.join("|")})`,back:"(\\d+)?"})}return{localRegexp:j,unitRegexp:$,numberRegexp:L,mixedNumberRegexp:z,localNumberRegexp:O,localDecimalRegexp:y,localFractionRegexp:k,localNegativeRegexp:F,mixedRegexp:I}},e.enLocalize=f,e.extractNumber=function(e,n=!0){const r=A(e),i=t.useNumberRegexp(r);if(n||0===i.length||e===r)return i;const o=t.createOrRegexp(i.sort(((e,t)=>String(t).length-String(e).length))),c=r.split(o).filter((e=>!!e)).sort(((e,t)=>t.length-e.length));return e.split(t.createOrRegexp(c)).filter((e=>!!e.trim()))},e.replaceLocalDecimal=l,e.replaceLocalFraction=u,e.replaceMixed=function(e){const t=e.match(r.mixedRegexp)||[];let n=e;return t.forEach((e=>{(e.match(/\d+/g)||[]).forEach((e=>{n=n.replace(e,i.toLocalized(parseInt(e)))}))})),n},e.replaceNumber=A,e.toFullLocalized=s,e.toFullNumber=a,e.updateLocalized=function(e,t){e&&o(e),t&&c(t)},e.updateLocalizedAlgorithm=c,e.updateLocalizedData=o,e.zhAlgorithm=M,e.zhLocalize=N}));
