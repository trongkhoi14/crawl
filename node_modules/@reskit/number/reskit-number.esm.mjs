import{createOrRegexp as t,createRegexp as e,useNumberRegexp as n}from"@reskit/shared";let r,i,o;function l(t){r=t,i=t.regexp}function c(t){o=t}function u(t,e){t&&l(t),e&&c(e)}function a(t){const e=t.match(i.localDecimalRegexp)||[];let n=t;return e.forEach((t=>{n=n.replace(t,o.toNumber(t).toString())})),n}function s(t){const e=t.match(i.localFractionRegexp)||[];let n=t;return e.forEach((t=>{n=n.replace(t,o.toNumber(t).toString())})),n}function f(t){const e=t.match(i.mixedRegexp)||[];let n=t;return e.forEach((t=>{(t.match(/\d+/g)||[]).forEach((t=>{n=n.replace(t,o.toLocalized(parseInt(t)))}))})),n}function g(t){if(!o||!o.toNumber)return t;const e=t.match(i.localNumberRegexp)||[],n=Object.keys(r.unit);let l=t;return e.forEach((t=>{n.includes(t)||(l=l.replace(t,o.toNumber(t).toString()))})),l}function m(t){if(!o||!o.toLocalized)return t;let e=t;return e=o.toLocalized(t),e=function(t){const e=t.match(i.localNegativeRegexp)||[];let n=t;return e.forEach((t=>{n=n.replace(t,o.toNumber(t).toString())})),n}(e),e=a(e),e=s(e),e}const p={num:{One:1,Two:2,Three:3,Four:4,Five:5,Six:6,Seven:7,Eight:8,Nine:9,Zero:0,Half:.5},unit:{Ten:10,Hundred:1e3,Thousand:1e3,Million:1e6,Billion:1e8},flag:"Point"},h={"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9,"十":10,"零":0,"〇":0,"两":2,"半":.5},d={0:"零",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七",8:"八",9:"九"},b={"十":10,"百":100,"千":1e3,"万":1e4,"亿":1e8},x=Object.keys(b),N="点",j="又",$="分之",R="负",k={localNumber:h,numberLocal:d,unit:b,decimalFlag:N};let I,S,E,y,F,O,L,v,z;function T(){if(!I){const n=Object.keys(h),r=Object.keys(d),i=Object.keys(b),o=[...n,...i];I=t(n,"+"),S=t(i),E=t(r,"+"),y=t(o,"+"),F=t([...o,...r],"+"),O=e(`{int}${N}{decimal}{unit}`,"g",{int:`(${o.join("|")})+`,decimal:`(${n.join("|")})+`,unit:`(${i.join("|")})?(${n.join("|")})*`}),L=e(`{base}${j}?{denominator}${$}{numerator}`,"g",{base:`(${o.join("|")})?`,denominator:`(${o.join("|")})+`,numerator:`(${o.join("|")})+`}),v=e(`${R}的?{int}`,"g",{int:`(${[...o,j,$,N].join("|")})+`}),z=e("{front}{unit}{back}","g",{front:"(\\d+(.\\d+)?)",unit:`(${i.join("|")})`,back:"(\\d+)?"})}return{localRegexp:I,unitRegexp:S,numberRegexp:E,mixedNumberRegexp:F,localNumberRegexp:y,localDecimalRegexp:O,localFractionRegexp:L,localNegativeRegexp:v,mixedRegexp:z}}function D(t){return x.some((e=>e===t))}function H(t){return["万","亿"].includes(t)}function M(t){return"零"===t}function W(t){let e=0;for(let n=0;n<t.length;n++)e=10*e+(h[t[n]]||0);return e}function w(t){return t.startsWith(R)?function(t){return(t=t.split(R)[1]).startsWith("的")&&(t=t.split("的")[1]),-w(t)}(t):t.includes(N)?function(t){const[e,n]=t.split(N),r=n.at(-1);let i=w(e.trim()),o=w(n.trim());if(r&&D(r)){i*=b[r];let t=0;for(;M(n[t]);)t+=1,o/=10;return i+o/10}return parseFloat(`${i}.${o}`)}(t):t.includes($)?function(t){let[e,n]=t.split(j);n||(n=e,e="");let[r,i]=n.split($),o=e?w(e.trim()):0,l=w(r.trim());return o+w(i.trim())/l}(t):function(t){let e=S.test(t);return S.lastIndex=0,e}(t)?function(t){let e=0,n=0,r="",i=0;for(;i<t.length;){const o=t[i];if(0===i&&D(o)){e=b[o],i++;continue}D(o)&&(e=H(o)?(e+n)*b[o]:e+n*b[o],r=M(t[i+1])?"":o,n=0,i++);let l=i;for(;i<t.length&&!D(t[i]);)i++;i>l&&(n=W(t.substring(l,i)))}return r&&(n=n*b[r]/10),e+n}(t):W(t)}const B={toNumber:w,toLocalized:function(t){if("string"==typeof t)return function(t){if(!isNaN(Number(t)))return t;let e=t.split("");for(let t=0;t<e.length;t++){const n=parseInt(e[t]);Number.isInteger(n)&&(e[t]=d[n]),"."===e[t]&&0!==t&&1!=e.length-1&&F.test(e[t-1])&&(F.lastIndex=0,(F.test(e[t+1])||Number.isInteger(parseInt(e[t+1])))&&(e[t]=N),F.lastIndex=0)}return e.join("")}(t);let e="";for(;t;)e=d[t%10]+e,t=Math.floor(t/10);return e}};function P(t){let e=t;return e=m(e),e=g(e),e}function Z(e,r=!0){const i=P(e),o=n(i);if(r||0===o.length||e===i)return o;const l=t(o.sort(((t,e)=>String(e).length-String(t).length))),c=i.split(l).filter((t=>!!t)).sort(((t,e)=>e.length-t.length));return e.split(t(c)).filter((t=>!!t.trim()))}export{T as createZhRegexp,p as enLocalize,Z as extractNumber,a as replaceLocalDecimal,s as replaceLocalFraction,f as replaceMixed,P as replaceNumber,m as toFullLocalized,g as toFullNumber,u as updateLocalized,c as updateLocalizedAlgorithm,l as updateLocalizedData,B as zhAlgorithm,k as zhLocalize};
